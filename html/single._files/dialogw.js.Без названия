function ck_dump(){console.log("-------------------------------"),console.log("------ДИНАМИЧЕСКИЕ ДАННЫЕ------"),console.log("-------------------------------"),console.log("ВЕРСИЯ СКРИПТА.............callkeep_vers.....= "+DialogWidget.globalDW.client_memory.getItem("callkeep_vers")),console.log("ИСТОЧНИК ВХОДА.............callkeep_rfr......= "+DialogWidget.globalDW.client_memory.getItem("callkeep_rfr")),console.log("ТОЧКА ВХОДА................callkeep_ep.......= "+DialogWidget.globalDW.client_memory.getItem("callkeep_ep")),console.log("ЗАГОЛОВОК ТОЧКИ ВХОДА......callkeep_ept......= "+DialogWidget.globalDW.client_memory.getItem("callkeep_ept")),console.log("h1 ТОЧКИ ВХОДА.............callkeep_eph1.....= "+DialogWidget.globalDW.client_memory.getItem("callkeep_eph1")),console.log("_openstat..................callkeep_os.......= "+DialogWidget.globalDW.client_memory.getItem("callkeep_os")),console.log("utm_campaign...............callkeep_utmcamp..= "+DialogWidget.globalDW.client_memory.getItem("callkeep_utmcamp")),console.log("utm_source.................callkeep_utmsrc...= "+DialogWidget.globalDW.client_memory.getItem("callkeep_utmsrc")),console.log("gclid......................callkeep_gclid....= "+DialogWidget.globalDW.client_memory.getItem("callkeep_gclid")),console.log("СОСТОЯНИЕ..................callkeep_cst......= "+DialogWidget.globalDW.client_memory.getItem("callkeep_cst")),console.log("СЧЁТ.......................callkeep_cs.......= "+DialogWidget.globalDW.client_memory.getItem("callkeep_cs")),console.log("АКТИВНЫЕ ОКНА..............callkeep_aw.......= "+DialogWidget.globalDW.client_memory.getItem("callkeep_aw")),console.log("ОТВЕТСТВЕННЫЙ..............callkeep_rflc.....= "+DialogWidget.globalDW.client_memory.getItem("callkeep_rflc")),console.log("ПОСЛЕДНЯЯ АКТИВАЦИЯ........callkeep_lat......= "+DialogWidget.globalDW.client_memory.getItem("callkeep_lat")),console.log("ПОСЛЕДНЕЕ ЗАКРЫТИЕ.........callkeep_lct......= "+DialogWidget.globalDW.client_memory.getItem("callkeep_lct")),console.log("ПОСЛЕДНЯЯ ОТПРАВКА.........callkeep_lst......= "+DialogWidget.globalDW.client_memory.getItem("callkeep_lst")),console.log("ПЕРВАЯ ОТПРАВКА............callkeep_fst......= "+DialogWidget.globalDW.client_memory.getItem("callkeep_fst")),console.log("ВСЕГО ОТПРАВЛЕНО...........callkeep_ts.......= "+DialogWidget.globalDW.client_memory.getItem("callkeep_ts")),console.log("ОБЩЕЕ ВРЕМЯ НА САЙТЕ.......callkeep_summsec..= "+DialogWidget.globalDW.client_memory.getItem("callkeep_summsec")),console.log("--------------------------"),console.log("---------НАСТРОЙКИ--------"),console.log("--------------------------"),console.log("ДАМП ОСН. ОБЪЕКТА...callkeep_main......: "),console.log(JSON.parse(DialogWidget.globalDW.client_memory.getItem("callkeep_main"))),console.log("ДАМП УСЛОВИЙ........callkeep_act_cond..: "),console.log(JSON.parse(DialogWidget.globalDW.client_memory.getItem("callkeep_act_cond")))}function ck_clear(){DialogWidget.globalDW.client_memory.clear()}var DialogWidget={};DialogWidget.DW=function(){function b(a){function c(){function e(){for(var b=a,c=0,d=0,e=b.act_cond.length;d<e;d++)b.act_cond[d]&&(c+=b.act_cond[d].giveSumScore());b.client_memory.setItem("callkeep_cs",parseFloat(b.client_memory.getItem("callkeep_cs"))+c),b.imActive(),ck_debug_periods&&console.log(b.client_memory.getItem("callkeep_cs")+" - "+b.client_memory.getItem("callkeep_aw")+"      ГЛАВНЫЙ-> "+b.client_memory.getItem("callkeep_rflc")+"       Я ГЛАВНЫЙ ->"+b.im_responsible+"        я один ->"+b.im_only_one+"       мой id -> "+b.ck_id),b.client_memory.getItem("callkeep_cs")>=b.fas||"form_was_activated"==b.client_memory.getItem("callkeep_cst")?(b.activatePopup(),b.stopKeeping(),b.clearScore(),b.waitOpenedForm()):"form_was_submitted"==b.client_memory.getItem("callkeep_cst")&&(ck_debug&&console.log("curr_total_score_watcher(): - форма была отправлена. Останавливаю отслеживание и сбрасываю счёт..."),b.stopKeeping(),b.clearScore())}ck_debug&&console.log("startKeeping(): - начинаю отслеживать действия пользователя...");var a=b;if(b.client_memory.setItem("callkeep_cst","keeping"),a.keeping_interval)return void(ck_debug&&console.log("startKeeping(): - keeping_interval не null, значит отслеживание уже запущено. ничего не делаю."));for(var c=0,d=b.act_cond.length;c<d;c++)b.act_cond[c]&&b.act_cond[c].startWatching();a.keeping_interval=setInterval(e,1e3)}function d(){b.im_responsible?(b.summsec++,b.client_memory.setItem("callkeep_summsec",b.summsec)):(b.summsec=b.client_memory.getItem("callkeep_summsec"),b.summsec||(b.summsec=0))}Object.defineProperty(this,"act_cond",{value:[],writable:!0,enumerable:!1,configurable:!0}),Object.defineProperty(this,"version",{value:"2.3",writable:!0,enumerable:!1,configurable:!0}),Object.defineProperty(this,"second_load",{value:!1,writable:!0,enumerable:!1,configurable:!0}),this.wid=a,this.summsec=0,Object.defineProperty(this,"summsec_interval",{value:null,writable:!0,enumerable:!1,configurable:!0}),Object.defineProperty(this,"cp",{value:"",writable:!0,enumerable:!1,configurable:!0}),Object.defineProperty(this,"empty_phrase",{value:!1,writable:!0,enumerable:!1,configurable:!0}),this.wtp="",this.nwtp="",this.wth="",this.nwth="",Object.defineProperty(this,"ch",{value:"",writable:!0,enumerable:!1,configurable:!0}),Object.defineProperty(this,"wtah",{value:"",writable:!0,enumerable:!1,configurable:!0}),Object.defineProperty(this,"nwtah",{value:"",writable:!0,enumerable:!1,configurable:!0}),this.lhint="",Object.defineProperty(this,"ahint",{value:"",writable:!0,enumerable:!1,configurable:!0}),Object.defineProperty(this,"chint",{value:"",writable:!0,enumerable:!1,configurable:!0}),this.sbe=null,this.sbs=null,this.lt,Object.defineProperty(this,"whacp",{value:"",writable:!0,enumerable:!1,configurable:!0}),Object.defineProperty(this,"nwhacp",{value:"",writable:!0,enumerable:!1,configurable:!0}),Object.defineProperty(this,"cpt",{value:"",writable:!0,enumerable:!1,configurable:!0}),this.lpt="",this.fas,this.rat,this.raast,this.srct,this.srcs,this.ya_c,Object.defineProperty(this,"rfr",{value:"",writable:!0,enumerable:!1,configurable:!0}),Object.defineProperty(this,"dp",{value:"//service.dialogwidget.ru/widget",writable:!1,enumerable:!1,configurable:!0}),Object.defineProperty(this,"fc",{value:"//service.dialogwidget.ru",writable:!1,enumerable:!1,configurable:!0}),Object.defineProperty(this,"keeping_interval",{value:null,writable:!0,enumerable:!1,configurable:!0}),Object.defineProperty(this,"start_keeping_timer",{value:null,writable:!0,enumerable:!1,configurable:!0}),Object.defineProperty(this,"waiting_interval",{value:null,writable:!0,enumerable:!1,configurable:!0}),Object.defineProperty(this,"waiting_active_interval",{value:null,writable:!0,enumerable:!1,configurable:!0}),Object.defineProperty(this,"client_memory",{value:this.defineClientStorage(),writable:!0,enumerable:!1,configurable:!0}),Object.defineProperty(this,"ck_id",{value:(new Date).getTime()+"",writable:!0,enumerable:!1,configurable:!0}),Object.defineProperty(this,"im_responsible",{value:!1,writable:!0,enumerable:!1,configurable:!0}),Object.defineProperty(this,"im_only_one",{value:!1,writable:!0,enumerable:!1,configurable:!0}),Object.defineProperty(this,"i_acted",{value:!1,writable:!0,enumerable:!1,configurable:!0}),Object.defineProperty(this,"popup_is_shown",{value:!1,writable:!0,enumerable:!1,configurable:!0}),Object.defineProperty(this,"last_presence_time",{value:!1,writable:!0,enumerable:!1,configurable:!0}),Object.defineProperty(this,"spec_keeping",{value:!1,writable:!0,enumerable:!1,configurable:!0}),Object.defineProperty(this,"stop_keeping_total",{value:!1,writable:!0,enumerable:!1,configurable:!0}),Object.defineProperty(this,"spec_init_wait_interval",{value:null,writable:!0,enumerable:!1,configurable:!0}),Object.defineProperty(this,"seconds_timer_interval",{value:null,writable:!0,enumerable:!1,configurable:!0}),Object.defineProperty(this,"timer_seconds",{value:null,writable:!0,enumerable:!1,configurable:!0}),Object.defineProperty(this,"ms_left",{value:null,writable:!0,enumerable:!1,configurable:!0}),this.csec,Object.defineProperty(this,"is_mobile",{value:this.checkIfMobile(),writable:!0,enumerable:!1,configurable:!0}),this.bp,this.sleep_def,this.cssp,this.imgp;var b=this;Object.defineProperty(this,"startKeeping",{value:c,writable:!0,enumerable:!1,configurable:!0}),Object.defineProperty(this,"countSummSec",{value:d,writable:!0,enumerable:!1,configurable:!0})}return b.prototype.init=function(){function e(a,b,c){var e=d,f=JSON.parse(a);ck_debug&&console.log("init() afterFirstLoad(): Пришёл ответ с сервера, разбираем его: "+a),f[0].lt=(new Date).getTime();var g=e.setupSetting(f[0],f[1]);g?(e.setSrctCookie(e.srct),e.createPhoneButton(),e.sleep_def&&!e.cpt&&"def"==e.lpt&&(ck_debug&&console.log("init() afterFirstLoad(): Флаг Sleep on Default - "+e.sleep_def+" и загруженная фраза lpt - "+e.lpt+". И cpt пуста. Накидываю недостижимых баллов в .fas"),e.fas+=1e4,f[0].fas+=1e4),e.client_memory.setItem("callkeep_main",JSON.stringify(f[0])),e.client_memory.setItem("callkeep_act_cond",JSON.stringify(f[1])),ck_debug&&console.log("init() afterFirstLoad(): Все данные записались успешно, запускаем отслеживание..."),e.showPhoneButton(),e.spec_keeping?(ck_debug&&console.log("init() afterFirstLoad(): Отмечено спец отслеживание для данной страницы. Не запускаю startKeeping(). Данные сохранены. Состояние ставлю -> keeping"),e.client_memory.setItem("callkeep_cst","keeping")):e.startKeeping()):ck_debug&&console.log("init() afterFirstLoad(): ОШИБКА! - не удалось сделать установку параметров.")}if(this.summsec_interval=setInterval(this.countSummSec,1e3),this.client_memory.getItem("callkeep_cst"))this.defineState()&&this.start();else{ck_debug&&console.log("init() - КУК НЕТ - новый клиент!!!"),this.client_memory.setItem("callkeep_vers",this.version),this.clearScore();var a={};a[this.ck_id]=(new Date).getTime(),this.client_memory.setItem("callkeep_aw",JSON.stringify(a)),this.client_memory.setItem("callkeep_ep",document.location.pathname),this.client_memory.setItem("callkeep_ept",$("title").text()),this.client_memory.setItem("callkeep_eph1",$("h1").eq(0).text());var b=this.urlGetParams(),c="";b._openstat&&(this.client_memory.setItem("callkeep_os",b._openstat),c+="&ck_os="+b._openstat,ck_debug&&console.log("init() - в запросе есть _openstat = "+b._openstat+" - передаём помимо точки входа ещё и его в БД для определения фразы...")),b.utm_campaign&&(this.client_memory.setItem("callkeep_utmcamp",b.utm_campaign),c+="&ck_camp="+b.utm_campaign,ck_debug&&console.log("init() - в запросе есть utm_campaign = "+b.utm_campaign+" - передаём помимо точки входа ещё и его в БД для определения фразы...")),b.utm_source&&(this.client_memory.setItem("callkeep_utmsrc",b.utm_source),c+="&ck_utmsrc="+b.utm_source,ck_debug&&console.log("init() - в запросе есть utm_source = "+b.utm_source+" - передаём и его в БД пока без надобности...")),b.gclid&&(this.client_memory.setItem("callkeep_gclid",b.gclid),c+="&ck_gclid="+b.gclid,ck_debug&&console.log("init() - в запросе есть gclid = "+b.gclid+" - передаём и его в БД пока без надобности...")),this.defineReferrer(),this.client_memory.setItem("callkeep_rflc",this.ck_id),this.im_responsible=!0,this.im_only_one=!0,this.client_memory.setItem("callkeep_cst","init"),ck_debug&&console.log("init() Отправляю запрос для точки входа: "+location.pathname),$.ajax({type:"POST",url:this.fc,data:"wid="+this.wid+"&op=load&ck_ep="+location.pathname+c+"&ep_url="+encodeURIComponent(location.href)+"&rfr_url="+encodeURIComponent(this.rfr),success:e})}var d=this},b.prototype.setSrctCookie=function(a){var b=new DialogWidget.CallKeepCookieHandler(2592e3,"/");b.setItem("dw_srct",a)},b.prototype.start=function(){function f(a,b,c){var d=e;ck_debug&&console.log("setParamsAndStartKeeping(): Пришёл ответ с сервера, разбираем его: "+a);var f=JSON.parse(a);f[0].lt=(new Date).getTime();var g=d.setupNewSettingsForEnterPoint(location.pathname,f);g&&(d.setSrctCookie(d.srct),d.sleep_def&&!d.cpt&&"def"==d.lpt&&(ck_debug&&console.log("init() setParamsAndStartKeeping(): Флаг Sleep on Default - "+d.sleep_def+" и загруженная фраза lpt - "+d.lpt+". И cpt пуста. Накидываю недостижимых баллов в .fas"),d.fas+=1e4,f[0].fas+=1e4),d.client_memory.setItem("callkeep_main",JSON.stringify(f[0])),d.client_memory.setItem("callkeep_act_cond",JSON.stringify(f[1])),d.startKeeping())}function g(a,b,c){var f=e;ck_debug&&console.log("setParamsAndWaitNextKeeping(): Пришёл ответ с сервера, разбираем: "+a);var g=JSON.parse(a);g[0].lt=(new Date).getTime();var h=f.setupNewSettingsForEnterPoint(location.pathname,g);h&&(f.setSrctCookie(f.srct),f.sleep_def&&!f.cpt&&"def"==f.lpt&&(ck_debug&&console.log("init() setParamsAndWaitNextKeeping(): Флаг Sleep on Default - "+f.sleep_def+" и загруженная фраза lpt - "+f.lpt+". И cpt пуста. Накидываю недостижимых баллов в .fas"),f.fas+=1e4,g[0].fas+=1e4),f.client_memory.setItem("callkeep_main",JSON.stringify(g[0])),f.client_memory.setItem("callkeep_act_cond",JSON.stringify(g[1])),f.start_keeping_timer=setTimeout(f.startKeeping,d),f.waitAndBeActive())}if(ck_debug&&console.log("start():  Приложение запущено. Статус: "+this.client_memory.getItem("callkeep_cst")),0==this.act_cond.length)return void console.log("start(): ОШИБКА! - нет условий. Ничего не запускаю...");this.createPhoneButton();var a=this.urlGetParams(),b="";switch(a._openstat&&(b+="&ck_os="+a._openstat,ck_debug&&console.log("start() - есть _openstat = "+a._openstat+" - готовим его для передачи в БД, если надо")),a.utm_campaign&&(b+="&ck_camp="+a.utm_campaign,ck_debug&&console.log("init() - в запросе есть utm_campaign = "+a.utm_campaign+" - готовим его для передачи в БД, если надо")),this.showPhoneButton(),this.client_memory.getItem("callkeep_cst")){case"keeping":if(ck_debug&&console.log("start(): callkeep_cst -> keeping"),this.im_only_one){var c=(new Date).getTime()-this.last_presence_time;c/1e3/60/60>24?(ck_debug&&console.log("start(): callkeep_cst -> keeping - скрипт одинок. С прошлой сессии остался статус keeping, и прошло больше 24 часов: "+c/1e3/60/60+". Считаем эту сессию новой. Делаю запрос к БД и запускаю отслеживание."),a._openstat?this.client_memory.setItem("callkeep_os",a._openstat):this.client_memory.removeItem("callkeep_os"),$.ajax({type:"POST",url:this.fc,data:"wid="+this.wid+"&op=load&ck_ep="+location.pathname+b+"&ep_url="+encodeURIComponent(location.href)+"&rfr_url="+encodeURIComponent(this.rfr),success:f})):(ck_debug&&console.log("start(): callkeep_cst -> keeping - скрипт одинок. С прошлой сессии остался статус keeping, и ещё не прошли сутки: "+c/1e3/60/60+". Считаем эту сессию действующей и запускаю отслеживание."),this.startKeeping())}else ck_debug&&console.log("start(): callkeep_cst -> keeping - скрипт не одинок."),this.startKeeping();break;case"form_was_activated":if(ck_debug&&console.log("start(): callkeep_cst -> form_was_activated"),this.im_only_one){this.client_memory.setItem("callkeep_cst","form_was_closed"),this.client_memory.setItem("callkeep_lct",this.last_presence_time),ck_debug&&console.log("start(): form_was_activated -> СКРИПТ ОДИНОК, переводим form_was_activated -> form_was_closed");var d=this.last_presence_time+1e3*this.rat-(new Date).getTime();d<=0?(ck_debug&&console.log("start(): form_was_activated->form_was_closed - уже пора запускать новое отслеживание. Загружаю настройки из БД и Запускаю отслеживание..."),a._openstat?this.client_memory.setItem("callkeep_os",a._openstat):this.client_memory.removeItem("callkeep_os"),$.ajax({type:"POST",url:this.fc,data:"wid="+this.wid+"&op=load&ck_ep="+location.pathname+b+"&ep_url="+encodeURIComponent(location.href)+"&rfr_url="+encodeURIComponent(this.rfr),success:f})):(ck_debug&&console.log("start(): form_was_activated->form_was_closed - Ещё рано запускать новое отслеживание. Таймер на запуск через "+d/1e3+" секунд."),this.start_keeping_timer=setTimeout(this.startKeeping,d),this.waitAndBeActive())}else ck_debug&&console.log("start(): form_was_activated -> скрипт не одинок, показываем форму и ждём реакции пользователя"),this.showPopup(),this.waitOpenedForm();break;case"form_was_closed":ck_debug&&console.log("start(): form_was_closed -- Смотрим пора ли запускать скрипт...");var d=parseInt(this.client_memory.getItem("callkeep_lct"))+1e3*this.rat-(new Date).getTime();ck_debug&&console.log("start(): form_was_closed -- ждать ещё "+d/1e3+" секунд"),d<=0?(ck_debug&&console.log("start(): form_was_closed -- Время активации уже подошло. Загружаю настройки из БД и запускаю отслеживание...."),a._openstat?this.client_memory.setItem("callkeep_os",a._openstat):this.client_memory.removeItem("callkeep_os"),$.ajax({type:"POST",url:this.fc,data:"wid="+this.wid+"&op=load&ck_ep="+location.pathname+b+"&ep_url="+encodeURIComponent(location.href)+"&rfr_url="+encodeURIComponent(this.rfr),success:f})):(ck_debug&&console.log("start(): form_was_closed -- Запускать отслеживание ещё рано. Ставлю таймер на запуск через "+d/1e3+" секунд."),this.start_keeping_timer=setTimeout(this.startKeeping,d),this.waitAndBeActive());break;case"form_was_submitted":ck_debug&&console.log("start(): form_was_submitted -- Смотрим сколько времени осталось до запуска скрипта...");var d=parseInt(this.client_memory.getItem("callkeep_lst"))+1e3*this.raast-(new Date).getTime();d<=0?(ck_debug&&console.log("start(): form_was_submitted -- Время активации после сабмита уже подошло. Загружаю настройки из БД и запускаю отслеживание...."),a._openstat?this.client_memory.setItem("callkeep_os",a._openstat):this.client_memory.removeItem("callkeep_os"),$.ajax({type:"POST",url:this.fc,data:"wid="+this.wid+"&op=load&ck_ep="+location.pathname+b+"&ep_url="+encodeURIComponent(location.href)+"&rfr_url="+encodeURIComponent(this.rfr),success:f})):d/1e3<600?(ck_debug&&console.log("start(): form_was_submitted -- До запуска отслеживания осталось меньше 10 минут: "+d/1e3/60+". Загружаю настройки из БД и ставлю таймер на начало отслеживания..."),a._openstat?this.client_memory.setItem("callkeep_os",a._openstat):this.client_memory.removeItem("callkeep_os"),$.ajax({type:"POST",url:this.fc,data:"wid="+this.wid+"&op=load&ck_ep="+location.pathname+b+"&ep_url="+encodeURIComponent(location.href)+"&rfr_url="+encodeURIComponent(this.rfr),success:g})):(this.hidePhoneButton(),ck_debug&&console.log("start(): form_was_submitted -- До запуска скрипта ещё долго: "+parseInt(d/1e3/60)+" минут. Ничего не делаю."))}var e=this},b.prototype.setupNewSettingsForEnterPoint=function(a,b){var c=this.setupSetting(b[0],b[1]);return c?(this.client_memory.setItem("callkeep_ep",a),this.client_memory.setItem("callkeep_ept",$("title").text()),this.client_memory.setItem("callkeep_eph1",$("h1").eq(0).text()),ck_debug&&console.log("Новые настройки для точки входа "+a+" установлены.")):ck_debug&&console.log("ОШИБКА! - Новые настройки для точки входа "+a+" НЕ установлены. В массиве из БД не все свойства преобразовываются в true."),c},b.prototype.defineState=function(){if(ck_debug&&console.log("defineState(): - КУКи ЕСТЬ считываем настройки и отмечаемся"),this.client_memory.getItem("callkeep_vers")!=this.version)return console.log("DialogWidget: версия скрипта не найдена или обновлена, делаю перезапуск..."),this.client_memory.clear(),this.second_load=!0,this.init(),!1;var a=JSON.parse(this.client_memory.getItem("callkeep_main")),b=JSON.parse(this.client_memory.getItem("callkeep_act_cond"));if(!this.setupSetting(a,b))return console.log("DialogWidget: Ошибка при попытке считать данные у клиента (defineState()). Делаю перезапуск..."),this.client_memory.clear(),this.second_load=!0,this.init(),!1;var c=JSON.parse(this.client_memory.getItem("callkeep_aw"));c[this.ck_id]=(new Date).getTime(),this.client_memory.setItem("callkeep_aw",JSON.stringify(c)),this.imActive();var d=parseInt(this.client_memory.getItem("callkeep_cs"));return(d<0||isNaN(d))&&(this.client_memory.setItem("callkeep_cs","0"),ck_debug&&console.log("defineState(): - КУКи ЕСТЬ: текущий счёт - не положительное число -> устанавливаем на 0 -> "+this.client_memory.getItem("callkeep_cs"))),this.rfr=this.client_memory.getItem("callkeep_rfr"),!0},b.prototype.setupSetting=function(a,b){var c=!0;if(!(a&&a.fas&&a.rat&&a.raast))return!1;if(!a.wtp&&!this.whacp)return ck_debug&&console.log("setupSetting() - не передана фраза. Данные не будут установлены. Виджет не запустится. Состояние: "+this.client_memory.getItem("callkeep_cst")),"init"==this.client_memory.getItem("callkeep_cst")&&ck_clear(),this.empty_phrase=!0,!1;if(this.wtp=a.wtp,this.nwtp=a.nwtp,this.wth=a.wth,this.nwth=a.nwth,this.lhint=a.hint||$("h1").eq(0).text(),this.lpt=a.cpt,this.sbe=a.sbe,this.sbs=a.sbs,this.lt=a.lt,this.fas=a.fas,this.bp=a.bp,this.rat=a.rat,this.raast=a.raast,this.csec=a.csec,this.sleep_def=a.sleep,this.ya_c=a.ya_c,this.srct=a.srct,this.srcs=a.srcs,this.cssp=a.cssp,this.imgp=a.imgp,!b)return!1;for(var d=0,e=b.length;d<e;d++){var f=DialogWidget.ActionCondition.prototype.createConditionObject(b[d].vn,b[d].av,b[d].asc,this);f.vn&&f.av&&f.asc||(c=!1),f&&this.act_cond.push(f)}return this.activateUserForms(),$("#dw_styles").is("link")?$("#dw_styles").attr("href",this.dp+this.cssp+"dialogwidget.css"):$("head").append('<link rel="stylesheet" type="text/css" href="'+this.dp+this.cssp+'dialogwidget.css" id="dw_styles" />'),c},b.prototype.urlGetParams=function(){var a=window.location.search,b=[],c=[],d={};if(b=a.substr(1).split("&"),""==b[0])return!1;for(i=0;i<b.length;i++)c=b[i].split("="),d[c[0]]=c[1];return d},b.prototype.stopKeeping=function(a){a&&(this.stop_keeping_total=!0),clearInterval(this.keeping_interval);for(var b=0,c=this.act_cond.length;b<c;b++)this.act_cond[b]&&this.act_cond[b].stopWatching();this.keeping_interval=null,ck_debug&&console.log("stopKeeping(): Отслеживание по всем условиям остановлено. keeping_interval ->null")},b.prototype.waitOpenedForm=function(){function b(){var b=a;b.imActive();var c=b.client_memory.getItem("callkeep_cst");switch(c){case"form_was_closed":ck_debug&&console.log("waitingOpenedFormFunction(): Текущее состояние формы изменилось на form_was_closed прекращаем ожидание, скрываем форму, УСТАНАВЛИВАЕМ ТАЙМЕР запуска формы через "+b.rat+" секунд"),b.hidePopup(),b.start_keeping_timer=setTimeout(b.startKeeping,1e3*b.rat),b.waitAndBeActive(),clearInterval(b.waiting_interval),b.showPhoneButton();break;case"form_was_submitted":ck_debug&&console.log("waitingOpenedFormFunction(): Текущее состояние формы изменилось на form_was_submitted прекращаем ожидание"),b.i_acted||(ck_debug&&console.log("waitingOpenedFormFunction(): форма была отправлена в другом окне. Скрываем нашу.."),b.hidePopup()),clearInterval(b.waiting_interval);break;case"keeping":ck_debug&&console.log("waitingOpenedFormFunction(): Текущее состояние формы изменилось на keeping - прячу форму и начинаю отслеживание."),b.hidePopup(),b.startKeeping(),clearInterval(b.waiting_interval);break;case"error":ck_debug&&console.log("waitingOpenedFormFunction(): Текущее состояние формы изменилось на error - ничего не делаем"),b.hidePopup(),clearInterval(b.waiting_interval)}ck_debug_periods&&console.log("waitingOpenedFormFunction(): - "+b.client_memory.getItem("callkeep_aw")+"      ГЛАВНЫЙ-> "+b.client_memory.getItem("callkeep_rflc")+"       Я ГЛАВНЫЙ ->"+b.im_responsible+"        я один ->"+b.im_only_one+"       мой id -> "+b.ck_id)}var a=this;ck_debug&&console.log("Начинаю отслеживать открытую форму..."),this.waiting_interval=setInterval(b,1e3)},b.prototype.waitAndBeActive=function(){function b(){var b=a;b.imActive(),"keeping"!=b.client_memory.getItem("callkeep_cst")&&"error"!=b.client_memory.getItem("callkeep_cst")||(clearTimeout(b.start_keeping_timer),b.startKeeping(),ck_debug&&console.log("waitAndBeActive(): Состояние изменилось на Keeping. Очищаю таймер на запуск отслеживания и начинаю отслеживание."),clearInterval(b.waiting_active_interval)),"form_was_activated"==b.client_memory.getItem("callkeep_cst")&&(b.popup_is_shown?ck_debug&&console.log("waitAndBeActive(): Прямой вызов окна... Стираю таймер запуска отслеживания, waiting_active_interval и начинаю отслеживание открытой формы."):(ck_debug&&console.log("waitAndBeActive(): в другой вкладке была нажата кнопка. Показываю форму, стираю таймер запуска отслеживания, waiting_active_interval и начинаю отслеживание открытой формы."),b.showPopup()),clearTimeout(b.start_keeping_timer),clearInterval(b.waiting_active_interval),b.waitOpenedForm()),ck_debug_periods&&console.log("waitAndBeActive(): - "+b.client_memory.getItem("callkeep_aw")+"      ГЛАВНЫЙ-> "+b.client_memory.getItem("callkeep_rflc")+"       Я ГЛАВНЫЙ ->"+b.im_responsible+"        я один ->"+b.im_only_one+"       мой id -> "+b.ck_id)}var a=this;this.waiting_active_interval=setInterval(b,1e3)},b.prototype.createPhoneButton=function(){function f(a){var f=c.scrollTop()-d,h=parseInt(b.css("bottom"));b.css("bottom",h+f+"px"),0==e&&(e=setTimeout(g,500)),d=c.scrollTop()}function g(){b.css("bottom",""),e=0}function i(){var a=h;return ck_debug&&console.log("buttonAct() - кнопка нажата. Останавливаю отслеживание, waiting_active_interval и удаляю таймер запуска keeping."),a.activatePopup(),a.stopKeeping(),a.client_memory.setItem("callkeep_cs","0"),clearTimeout(a.start_keeping_timer),clearInterval(a.waiting_active_interval),a.waitOpenedForm(),a.hidePhoneButton(),!1}var a;a=this.is_mobile?'<a href="#" id="ck_phone_a" class="ck-phone-link ck-phone-link-hidden ck-phone-link-mobile ck-phone-link-mobile-'+this.bp+'"><img src="'+this.dp+this.imgp+"ck_phone_mob_"+this.bp+'.png"></a>':'<a href="#" id="ck_phone_a" class="ck-phone-link ck-phone-link-hidden"><img src="'+this.dp+this.imgp+'ck_phone.png"></a>',$("body").append(a);var b=$("#ck_phone_a"),c=$(window),d=c.scrollTop(),e=0;this.is_mobile||c.scroll(f),b.click(i);var h=this},b.prototype.showPhoneButton=function(){return this.empty_phrase?void(ck_debug&&console.log("- showPhoneButton() - у скрипта нет фразы для показа. не отображаю кнопку...")):($("a#ck_phone_a").removeClass("ck-phone-link-hidden"),void($("a#ck_phone_a").attr("title")||$("a#ck_phone_a").attr("title",this.cp)))},b.prototype.hidePhoneButton=function(){$("a#ck_phone_a").addClass("ck-phone-link-hidden")},b.prototype.createPopup=function(){function b(b){function d(a){a?($("input#ck_phone_submit").removeAttr("disabled"),$("#callkeep_timer").removeClass("ck-timer-inactive").addClass("ck-timer-preactive")):($("input#ck_phone_submit").attr("disabled","disabled"),$("#callkeep_timer").removeClass("ck-timer-preactive").addClass("ck-timer-inactive"))}function e(a){function g(a,e,f){function l(){if(b.ms_left>=90){if(0==b.timer_seconds)return b.timer_seconds=0,h.html("Благодарим за ожидание!<br>Менеджер перезвонил Вам?"),i.text("00"),j.text("00"),$("#callkeep_timer").hide(),$("#ck_aftercall_form").show(),ck_debug&&console.log("Сабмит формы: Таймер закончил отсчёт показываю кнопки."),clearInterval(b.seconds_timer_interval),delete b.seconds_timer_interval,void $("a#ck_close_box_a").unbind("click").click(function(a){return c.hidePopup(),$("#ck_aftercall_form").hide(),!1});b.timer_seconds--,i.text(b.timer_seconds>=10?b.timer_seconds:"0"+b.timer_seconds),b.ms_left=-10,k.toggleClass("ck-timer-dots-hidden")}40==b.ms_left&&k.toggleClass("ck-timer-dots-hidden"),b.ms_left+=10,j.text(b.ms_left>0?100-b.ms_left+Math.floor(10*Math.random()-1):"00")}var g=JSON.parse(a);$("#ck_aftercall_lid_hid").val(g.lid),$("#ck_aftercall_phone_hid").val($("#ck_phone_input").val());var h=$("div#ck_phrase");if(ck_debug&&console.log("Сабмит формы: Получен ответ: "),ck_debug&&console.log(g),$("img#ck_loading_icon").hide(),h.text(g.text).show(),"error"==g.status)return ck_debug&&console.log("Сабмит формы: Статус ответа - ошибка"),"phone"==g.errorcode&&(ck_debug&&console.log("Сабмит формы: ОШИБКА не верно введён телефон! Устанавливаю состояние form_was_activated и показываю форму."),$("input#ck_phone_input").val(""),d(!1),b.displayTimer(),$("form#callkeep_form").show(),b.client_memory.setItem("callkeep_cst","form_was_activated"),$("a#ck_close_box_a").unbind("click").click(function(a){return b.closePopup(),b.showPhoneButton(),!1})),void("spam_block"==g.errorcode&&(ck_debug&&console.log("Сабмит формы: ОШИБКА превышен лимит заявок. Показываю уведомление и ничего не делаю."),$("input#ck_phone_input").val(""),d(!1)));if("function"==typeof ga&&ga("send","event","DialogWidget","DialogWidget Submit"),"object"==typeof _gaq&&"function"==typeof _gaq.push&&_gaq.push(["_trackEvent","DialogWidget","DialogWidget Submit"]),b.ya_c&&window["yaCounter"+b.ya_c].reachGoal("DialogWidget_Submit"),"function"==typeof DialogWidgetSubmit?(ck_debug&&console.log("Сабмит формы: DialogWidgetSubmit запуск функции"),DialogWidgetSubmit()):ck_debug&&console.log("Сабмит формы: DialogWidgetSubmit функция не найдена"),g.wh&&"spam_call"!=g.errorcode){ck_debug&&console.log("Сабмит формы: Время рабочее - запускаю таймер..."),$("#callkeep_timer").show(),$("#ck_aftercall_form_box").show(),b.timer_seconds=b.csec,b.ms_left=100;var i=$("#ck_timer_seconds"),j=$("#ck_timer_milliseconds"),k=$("#ck_timer_dots");b.seconds_timer_interval=setInterval(l,100)}else ck_debug&&("spam_call"==g.errorcode?console.log("Сабмит формы: Заявка с блокировкой звонка. Показываю благодарность."):console.log("Сабмит формы: Время не рабочее показываю благодарность.")),h.addClass("ck-response"),d(!0),$("a#ck_close_box_a, div#ck_overlay").on("click",function(a){return h.removeClass("ck-response"),!1})}if(a.preventDefault(),!$("input#ck_phone_input").val())return ck_debug&&console.log("ОШИБКА - Сабмит формы: поле телефона не заполнено. Прерываю обработку сабмита."),$("input#ck_phone_input").attr("placeholder","введите телефон..."),!1;var b=c;b.i_acted=!0,ck_debug&&console.log("Сабмит формы: скрываю форму и фразу..."),$("form#callkeep_form").hide(),$("div#ck_phrase").hide(),$("img#ck_loading_icon").show(),$("#callkeep_timer").removeClass("ck-timer-preactive").hide(),ck_debug&&console.log("Сабмит формы: Устанавливаю состояние в form_was_submitted и фиксирую время..."),b.client_memory.setItem("callkeep_cst","form_was_submitted"),b.client_memory.setItem("callkeep_lst",(new Date).getTime());var e=parseInt(b.client_memory.getItem("callkeep_ts"));"number"!=typeof e||isNaN(e)?(b.client_memory.setItem("callkeep_ts",1),ck_debug&&console.log("Сабмит формы: Количество отправленных заявок не определилось ставлю 1")):(b.client_memory.setItem("callkeep_ts",e+1),ck_debug&&console.log("Сабмит формы: Эта заявка отправлена по счёту: "+(e+1))),$("a#ck_close_box_a").unbind("click").text("закрыть"),$("div#ck_overlay").unbind("click"),$("a#ck_close_box_a").click(function(a){return b.hidePopup(),b.seconds_timer_interval&&(clearInterval(b.seconds_timer_interval),$("#ck_timer_seconds").text(b.csec),$("#ck_timer_milliseconds").text("00")),!1}),ck_debug&&console.log("Сабмит формы: Делаю запрос...");var f=$(this).serialize();$.ajax({type:"POST",url:b.fc,data:f,success:g})}function f(a){ck_debug&&console.log("Ответ клиента: ДА. Скрываю форму и отправляю запрос на подтверждение заявки."),a.preventDefault(),c.hidePopup(),$("#ck_aftercall_answer_hid").val("yes"),$("#ck_aftercall_form").hide();var b=$("form#ck_aftercall_form").serialize();return $.ajax({type:"POST",url:c.fc,data:b}),!1}function g(a){ck_debug&&console.log("Ответ клиента: НЕТ. Скрываю форму, показываю уведомление и отправляю запрос на подтверждение заявки."),a.preventDefault(),$("#ck_aftercall_form").hide(),$("#ck_aftercall_form_box").hide(),$("div#ck_phrase").html("Уведомление отправлено.<br><br>Приносим извинения за неудобства. Похоже, что все менеджеры были заняты. Мы свяжемся с вами в ближайшее время.").css("height","auto"),$("#ck_aftercall_answer_hid").val("no"),$("div#ck_overlay").click(function(a){"ck_overlay"==a.target.id&&c.hidePopup()});var b=$("form#ck_aftercall_form").serialize();return $.ajax({type:"POST",url:c.fc,data:b}),!1}var c=a;c.is_mobile&&$("div#ck_box").addClass("ck-mobile-box"),$(this).toggleClass("ck-overlay-blur-flag").show(),c.setPhrase(c.cp,c.cpt,c.ch),c.setHint(c.chint),$("a#ck_close_box_a").click(function(a){return c.closePopup(),c.showPhoneButton(),!1}),
$("div#ck_overlay").click(function(a){"ck_overlay"==a.target.id&&(c.closePopup(),c.showPhoneButton())}),$("input#ck_ep_hid").val(c.client_memory.getItem("callkeep_ep")),$("input#ck_ep_title_hid").val(c.client_memory.getItem("callkeep_ept")),$("input#ck_actp_hid").val(window.location.pathname),$("input#ck_actp_title_hid").val($("title").text()),c.client_memory.getItem("callkeep_os")&&$("input#ck_openstat_hid").val(c.client_memory.getItem("callkeep_os")),c.client_memory.getItem("callkeep_utmcamp")&&$("input#ck_camp_hid").val(c.client_memory.getItem("callkeep_utmcamp")),c.client_memory.getItem("callkeep_utmsrc")&&$("input#utm_src_hid").val(c.client_memory.getItem("callkeep_utmsrc")),c.client_memory.getItem("callkeep_gclid")&&$("input#gclid_hid").val(c.client_memory.getItem("callkeep_gclid")),$("input#source_hid").val(c.rfr),$("#ck_aftercall_timer").data("recallsec",c.csec),$("#ck_timer_seconds").text(c.csec>=10?c.csec:"0"+c.csec),$("input.dw-wid-hid").val(c.wid),$("img.ck-form-image").each(function(){$(this).attr("src",c.dp+c.imgp+$(this).attr("src"))}),"function"!=typeof $("input#ck_phone_input").mask?(ck_debug&&console.log("createPopup(): Функция .mask - не функция :) Наверно плагин Masked Input не установлен. Подключаю плагин от себя..."),$.getScript(c.dp+"/jquery.maskedinput.js",function(a){$("input#ck_phone_input").mask("+7 (999) 999-99-99",{placeholder:"_"})})):$("input#ck_phone_input").mask("+7 (999) 999-99-99",{placeholder:"_"}),$("input#ck_phone_input").keyup(function(a){var b=$(this).val().replace(/\D/g,"");d(11==b.length)}),$("#ck_autor_link").on("click",function(a){var b="//dialogwidget.ru/widget.php",d="?tr=";d+=c.srct?c.srct.substring(0,1)+"*":"*",d+=c.srcs?c.srcs+"*":"*",d+=c.summsec?c.summsec+"*":"*";var e=c.client_memory.getItem("callkeep_eph1");e&&(d+=encodeURIComponent(e.replace("*"," "))),$(this).attr("href",b+d),setTimeout(function(){$("#ck_autor_link").attr("href","//dialogwidget.ru/")},1e3)}),$("#callkeep_form").on("submit",e),$("#ck_aftercall_yes").click(f),$("#ck_aftercall_no").click(g)}ck_debug&&console.log("- DW.prototype.createPopup - вставляем в HTML старницы окно и кнопку DW...");var a=this;$("body").prepend('<div id="ck_overlay" style="display:none;"><div>'),$("div#ck_overlay").load(this.fc,{wid:this.wid,op:"popup"},b)},b.prototype.closePopup=function(){this.hidePopup(),this.client_memory.setItem("callkeep_cst","form_was_closed"),this.client_memory.setItem("callkeep_lct",(new Date).getTime()),ck_debug&&console.log("closePopup(): форма закрыта с записью состояния")},b.prototype.hidePopup=function(){"function"==typeof ga&&ga("send","event","DialogWidget","DialogWidget Closed"),$("div#ck_overlay").removeClass("ck-overlay-blur-flag").hide(),this.popup_is_shown=!1,ck_debug&&console.log("hidePopup(): форма скрыта без записи состояния")},b.prototype.showPopup=function(a,b,c,d,e){return this.popup_is_shown?void(ck_debug&&console.log("showPopup(): Окно с формой уже показано. Ничего не делаю.")):(this.popup_is_shown=!0,this.hidePhoneButton(),a&&b?(this.cpt="once",ck_debug&&console.log("showPopup(): Переданы 2 аргумента - прямой вызов окна - тип фразы - once"),this.cp=this.currPhrase(a,b),this.chint=c,this.ch=d&&e?this.currHeading(d,e):d):a?(this.cp=a,this.cpt="once",ck_debug&&console.log("showPopup(): Передан 1 аргумент - прямой вызов окна - тип фразы - once"),this.chint=c,this.ch=d&&e?this.currHeading(d,e):d):this.whacp&&this.nwhacp?(ck_debug&&console.log("showPopup(): Есть 2 альтернативные фразы - тип фразы - "+this.cpt),this.cp=this.currPhrase(this.whacp,this.nwhacp),this.chint=this.ahint,this.ch=this.wtah&&this.nwtah?this.currHeading(this.wtah,this.nwtah):this.wtah):this.whacp?(ck_debug&&console.log("showPopup(): Есть 1 альтернативная фраза - тип фразы - "+this.cpt),this.cp=this.whacp,this.chint=this.ahint,this.ch=this.wtah&&this.nwtah?this.currHeading(this.wtah,this.nwtah):this.wtah):(this.cpt=this.lpt,ck_debug&&console.log("showPopup(): Обычный режим выбираем из 2 фраз из БД. тип - "+this.cpt),this.cp=this.currPhrase(),this.chint=this.lhint,this.ch=this.currHeading()),$("div#ck_overlay").is("div")?(ck_debug&&console.log("showPopup(): форма уже существует, просто показываем её..."),$("div#ck_overlay").addClass("ck-overlay-blur-flag").show(),this.setPhrase(this.cp,this.cpt,this.ch),this.setHint(this.chint),this.displayTimer()):this.createPopup(),"function"==typeof ga&&ga("send","event","DialogWidget","DialogWidget Opened"),void("function"==typeof DialogWidgetWindowOpen?(ck_debug&&console.log("Открытие формы: DialogWidgetWindowOpen запуск функции"),DialogWidgetWindowOpen()):ck_debug&&console.log("Открытие формы: DialogWidgetWindowOpen функция не найдена")))},b.prototype.activatePopup=function(a,b,c,d,e){this.client_memory.setItem("callkeep_cst","form_was_activated"),this.client_memory.setItem("callkeep_lat",(new Date).getTime()),a?this.showPopup(a,b,c,d,e):this.showPopup(),ck_debug&&console.log("activatePopup() - форма активирована с записью состояния и времени активации.")},b.prototype.displayTimer=function(){this.popup_is_shown&&(this.checkWh()?($("span#ck_timer_seconds").text(this.csec),$("form#callkeep_form").removeClass("unwh").show(),$("div#callkeep_timer").removeClass("unwh").show(),ck_debug&&console.log("displayTimer(): форма показана в рабочее время, показываю таймер...")):($("form#callkeep_form").addClass("unwh"),$("div#callkeep_timer").addClass("unwh").hide(),ck_debug&&console.log("displayTimer(): форма показана в НЕ рабочее время, скрываю таймер...")))},b.prototype.imActive=function(){var a=0,b=0,c=this.client_memory.getItem("callkeep_rflc"),d=JSON.parse(this.client_memory.getItem("callkeep_aw"));d[this.ck_id]=(new Date).getTime();for(var e in d)(new Date).getTime()-d[e]>1005?(d[e]>b&&(b=d[e]),delete d[e],ck_debug&&console.log("imActive -> "+e+" просрочен. Удаляем его.")):a++;this.client_memory.setItem("callkeep_aw",JSON.stringify(d)),d[c]||(ck_debug&&console.log("imActive -> ответственный "+c+" пропал. Я за него! -> "+this.ck_id),this.client_memory.setItem("callkeep_rflc",this.ck_id),this.im_responsible=!0),a>1?this.im_only_one=!1:this.im_only_one=!0,b&&!this.last_presence_time&&this.im_only_one&&(this.last_presence_time=b,ck_debug&&console.log("imActive -> установлено время последнего присутствия на сайте с прошлой сессии: "+b)),d=JSON.parse(this.client_memory.getItem("callkeep_aw")),c=this.client_memory.getItem("callkeep_rflc"),d[c]&&this.ck_id!=c&&(this.im_responsible=!1)},b.prototype.checkWh=function(){var a=((new Date).getTime()-this.lt)/1e3;return null!==this.sbe?a>this.sbe?(ck_debug&&console.log("checkWh() - проверка рабочего времени: фраза была загружена в рабочее время, но рабочее время подошло к концу. Сейчас НЕ РАБОЧЕЕ ВРЕМЯ."),!1):(ck_debug&&console.log("checkWh() - проверка рабочего времени: фраза была загружена в рабочее время, сейчас всё ещё РАБОЧЕЕ ВРЕМЯ."),!0):null!==this.sbs?a>this.sbs?(ck_debug&&console.log("checkWh() - проверка рабочего времени: фраза была загружена в не рабочее время, но рабочее время уже началось. Сейчас РАБОЧЕЕ ВРЕМЯ."),!0):(ck_debug&&console.log("checkWh() - проверка рабочего времени: фраза была загружена в не рабочее время, Сейчас всё ещё НЕ РАБОЧЕЕ ВРЕМЯ. sbs = "+this.sbs+", со времени загрузки прошло "+a),!1):void 0},b.prototype.clearScore=function(){this.client_memory.setItem("callkeep_cs","0"),ck_debug&&console.log("clearScore() - счёт установлен на 0")},b.prototype.currPhrase=function(a,b){var c=this.checkWh();return a||b?a&&b?(ck_debug&&console.log("currPhrase() - выбрана фраза из переданных вручную"),c?a:b):(console.log("currPhrase() - Ошибка! Эта Ф-я принимает только 0 или 2 аргумента"),!1):(ck_debug&&console.log("currPhrase() - выбрана фраза из БД"),c?this.wtp:this.nwtp)},b.prototype.currHeading=function(a,b){var c=this.checkWh();return a||b?a&&b?(ck_debug&&console.log("currHeading() - выбраем заголовок из переданных"),c?a:b):(console.log("currHeading() - Ошибка! Эта Ф-я принимает только 0 или 2 аргумента"),!1):(ck_debug&&console.log("currHeading() - выбраем заголовок из БД"),c?this.wth:this.nwth)},b.prototype.setPhrase=function(a,b,c){if(a){var d=new RegExp(" за.*?секунд"),e=a.match(d),f=!1;e&&(f=a.replace(d,' <span id="ck_phrase_time">за '+this.csec+" секунд</span>")),f||(f=a),c?($("#ck_box").addClass("dw-box-with-heading"),f='<span id="dw_phrase_heading">'+c+"</span> "+f):$("#ck_box").removeClass("dw-box-with-heading"),$("div#ck_overlay").is("div")&&($("div#ck_phrase").html(f),$("input#ck_act_phrase_hid").val((c||" ")+" "+a),$("input#ck_phr_type_hid").val(b)),ck_debug&&console.log("setPhrase() - установлены: заголовок - "+c+" фраза - "+a)}else ck_debug&&console.log("setPhrase() - пустая фраза!")},b.prototype.setHint=function(a){return a?(ck_debug&&console.log("setHint() - устанавливаю подсказку для менеджера: "+a),void $("input#ck_hint_hid").val(a)):(ck_debug&&console.log("setHint() - передана недействительная подсказка менеджеру - устанавливаю пустую"),void $("input#ck_hint_hid").val(""))},b.prototype.setPagePhrase=function(a,b,c,d,e){return a||b?(ck_debug&&console.log("setPagePhrase() - Сохраняю альтернативные фразы: whacp - "+a+" --- nwhacp: "+b+" --- ahint: "+c),this.whacp=a,this.nwhacp=b,this.ahint=c,this.wtah=d,this.nwtah=e,void(this.cpt="page")):(ck_debug&&console.log("setPagePhrase() - принимает только 1 или 2 аргумента альтернативная фраза не установлена!"),!1)},b.prototype.specialKeeping=function(a,b,c,d,e){function g(){var a=f;"keeping"==a.client_memory.getItem("callkeep_cst")&&(a.stop_keeping_total?ck_debug&&console.log("specialKeeping()->spec_init_wait() был применён полный стоп keeping. ничего не запускаю."):a.startKeeping(),clearInterval(a.spec_init_wait_interval))}if(!a&&!b)return void console.log("specialKeeping() - ОШИБКА! ф-я принимает только 1 или 2 аргумента. Сейчас оба недействительны. Специальный режим не запущен.");switch(ck_debug&&console.log("specialKeeping() - специальный режим для данной страницы... текущее состояние:"+this.client_memory.getItem("callkeep_cst")),this.spec_keeping=!0,this.setPagePhrase(a,b,c,d,e),this.cpt="spec",this.client_memory.getItem("callkeep_cst")){case"keeping":ck_debug&&console.log("specialKeeping() - текущее состояние - keeping. сбрасываю счёт и начинаю отслеживание..."),this.clearScore(),this.startKeeping();break;case"form_was_closed":ck_debug&&console.log("specialKeeping() - текущее состояние - form_was_closed. Очищаю WaitAndBeActive и таймер startKeeping..."),clearTimeout(this.start_keeping_timer),clearInterval(this.waiting_active_interval),this.startKeeping();break;case"form_was_activated":ck_debug&&console.log("specialKeeping() - текущее состояние - form_was_activated. Форма открыта и есть другие окна. Закрываю форму и начинаю новое отслеживание..."),this.closePopup(),this.startKeeping();break;case"init":this.spec_init_wait_interval=setInterval(g,500)}var f=this},b.prototype.defineClientStorage=function(){var a=new DialogWidget.CallKeepCookieHandler(86400,"/");if(a.getItem("callkeep_cst"))return ck_debug&&console.log("defineClientStorage() - Куки уже использовались. Данные будут сохраняться в них. Срок - сутки"),a;if(delete a,window.localStorage){ck_debug&&console.log("localStorage присутствует. Проверяем доступность и сохраняем данные в него если доступен.");var b;try{b=new DialogWidget.CallKeepLocalStorageHandler}catch(a){ck_debug&&console.log("localStorage заблокирован. Будут использоваться Cookie"),b=new DialogWidget.CallKeepCookieHandler(2592e3,"/")}return b}return ck_debug&&console.log("localStorage НЕ ПОДДЕРЖИВАЕТСЯ! Данные будут сохраняться в КУКАХ..."),new DialogWidget.CallKeepCookieHandler(2592e3,"/")},b.prototype.checkIfMobile=function(){var a=!1;return function(b){(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(b)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(b.substr(0,4)))&&(a=!0)}(navigator.userAgent||navigator.vendor||window.opera),ck_debug&&console.log("checkIfMobile() мобильность - "+a),a},b.prototype.defineReferrer=function(){this.rfr=document.referrer,this.client_memory.setItem("callkeep_rfr",this.rfr),ck_debug&&console.log("defineReferrer() - Установлен referrer: "+this.rfr)},b.prototype.activateUserForms=function(){function e(a){var b=$(this).val().replace(/\D/g,""),c=$(this).closest("form.dw-uform").find(".dw-uform-submit").eq(0);11!=b.length?c.attr("disabled","disabled"):c.removeAttr("disabled")}function f(b){function l(b,f,j){var k=JSON.parse(b);return h.hide(),ck_debug&&console.log("Сабмит пользовательской формы: Получен ответ: "),ck_debug&&console.log(k),"error"==k.status?(g.text(k.text),ck_debug&&console.log("Сабмит пользовательской формы: Статус ответа - ошибка"),void("phone"==k.errorcode&&(ck_debug&&console.log("Сабмит пользовательской формы: ОШИБКА не верно введён телефон! Устанавливаю состояние form_was_activated и показываю форму."),i.val(""),c.attr("disabled","disabled"),d.show()))):("function"==typeof ga&&"false"!=e&&(ga("send","event","DialogWidget","DialogWidget Submit"),ga("send","event","DialogWidget","DialogWidget UserForm Sent")),"object"==typeof _gaq&&"function"==typeof _gaq.push&&"false"!=e&&(_gaq.push(["_trackEvent","DialogWidget","DialogWidget Submit"]),_gaq.push(["_trackEvent","DialogWidget","DialogWidget UserForm Sent"])),a.ya_c&&window["yaCounter"+a.ya_c].reachGoal("DialogWidget_Submit"),"function"==typeof DialogWidgetSubmit?(ck_debug&&console.log("Сабмит формы: DialogWidgetSubmit запуск функции"),DialogWidgetSubmit()):ck_debug&&console.log("Сабмит формы: DialogWidgetSubmit функция не найдена"),g.text(k.text),k.wh||ck_debug&&console.log("Сабмит пользовательской формы: Время не рабочее показываю благодарность."),a.i_acted=!0,void a.client_memory.setItem("callkeep_cst","form_was_submitted"))}b.preventDefault();var c=$(this),d=c.closest("form.dw-uform"),e=d.data("dw-events")===!1?"false":"",f=d.data("dw-onlycall")===!0?"true":"",g=d.parent().find(".dw-uform-phrase").eq(0),h=d.siblings("img.dw-uform-load-image").eq(0),i=d.find("input.dw-uform-phone").eq(0),j=c.data("dw-uform-hint"),k="";g.data("dw-shown-phrase")||g.data("dw-shown-phrase",g.text()),k+="ck_phone="+i.val().replace(/\D/g,""),k+="&ck_ep="+encodeURIComponent(a.client_memory.getItem("callkeep_ep")),k+="&ck_ep_title="+encodeURIComponent(a.client_memory.getItem("callkeep_ept")),k+="&ck_act_phrase="+encodeURIComponent(g.data("dw-shown-phrase")),k+="&ck_hint="+encodeURIComponent(j),k+="&ck_phr_type=uform",k+="&ck_actp="+encodeURIComponent(window.location.pathname),k+="&ck_actp_title="+encodeURIComponent($("title").text()),k+="&ck_openstat="+(a.client_memory.getItem("callkeep_os")||""),k+="&ck_camp="+(a.client_memory.getItem("callkeep_utmcamp")||""),k+="&op=lead",k+="&wid="+a.wid,k+="&source="+(a.client_memory.getItem("callkeep_rfr")||""),k+="&utm_src="+(a.client_memory.getItem("callkeep_utmsrc")||""),k+="&gclid="+(a.client_memory.getItem("callkeep_gclid")||""),k+="&onlycall="+f,d.hide(),h.show(),ck_debug&&console.log("activateUserForms() - данные запроса: "+k),$.ajax({type:"POST",url:a.fc,data:k,success:l})}var a=this,b=$("form.dw-uform");if(0==b.length)return void(ck_debug&&console.log("activateUserForms(): Не найдено пользовательских форм. Ничего не делаю..."));var c=a.checkWh(),d=$('<img src="'+a.dp+a.imgp+'loading.gif" class="dw-uform-load-image">');b.each(function(a){var b=$(this),g=b.find(".dw-uform-submit").eq(0),h=b.find(".dw-uform-phone").eq(0),i=b.parent().find(".dw-uform-phrase").eq(0);g.length>0&&h.length>0&&(g.attr("disabled","disabled").unbind("click"),h.keyup(e),b.unbind("submit").addClass("dw-uform-active"),d.clone().insertBefore(b),i.length>0&&i.data("dw-wh-phr")&&i.data("dw-nwh-phr")&&(c?i.html(i.data("dw-wh-phr")):i.html(i.data("dw-nwh-phr"))),g.click(f))}),"function"!=typeof $.mask?(ck_debug&&console.log("activateUserForms(): Функция .mask - не функция :) Наверно плагин Masked Input не установлен. Подключаю плагин от себя..."),$.getScript(this.dp+"/jquery.maskedinput.js",function(a){$("form.dw-uform-active input.dw-uform-phone").attr("placeholder","+7 (___) ___-__-__").mask("+7 (999) 999-99-99",{placeholder:"_"})})):$("form.dw-uform-active input.dw-uform-phone").attr("placeholder","+7 (___) ___-__-__").mask("+7 (999) 999-99-99",{placeholder:"_"})},b}(),DialogWidget.ActionCondition=function(){function b(a,b,c){if(this.av=a,this.asc=parseInt(b)||0,Object.defineProperty(this,"ca",{value:0,writable:!0,enumerable:!1,configurable:!0}),Object.defineProperty(this,"cuss",{value:0,writable:!0,enumerable:!1,configurable:!0}),this.vn="action_condition",Object.defineProperty(this,"watcher_timer",{value:null,writable:!0,enumerable:!1,configurable:!0}),!(c instanceof DialogWidget.DW))throw new Error("ActionCondition _constructor - Объекту условия надо передавать экземпляр основного объекта DW!!!");Object.defineProperty(this,"main_ck_obj",{value:c,writable:!0,enumerable:!1,configurable:!0})}return b.prototype.createConditionObject=function(a,b,c,d){if(!(parseInt(c)>0))return console.log("ОШИБКА! ActionCondition.prototype.createConditionObject: при создании условия "+a+" - activ_score должен быть положительным числом больше 0"),!1;switch(a){case"sess_time":return new DialogWidget.ActCond_Session_Time(b,c,d)}return console.log("ОШИБКА! ActionCondition.prototype.createConditionObject: не нашлось условий с именем переменной "+a),!1},b.prototype.startWatching=function(){throw new Error("ActionCondition.startWatching - абстрактная функция должна реализовываться во всех подклассах!")},b.prototype.stopWatching=function(){clearInterval(this.watcher_timer),this.cuss=0},b.prototype.giveSumScore=function(){var a=this.cuss;return this.cuss=0,a},b}(),DialogWidget.ActCond_Session_Time=function(){function b(a,b,c){DialogWidget.ActionCondition.call(this,a,b,c),this.vn="sess_time",this.startWatching=function(){function c(){if(b.im_responsible){var e,d=a;e=d.asc/d.av,d.cuss+=parseFloat(e.toFixed(3))}}var a=this,b=this.main_ck_obj;this.watcher_timer=setInterval(c,1e3)}}return b.prototype=DialogWidget.ActionCondition.prototype,b.prototype.constructor=b,b}(),DialogWidget.CallKeepCookieHandler=function(){function b(a,b){function f(){var a={},b=document.cookie;""===b&&(e=a);for(var f=b.split("; "),g=0;g<f.length;g++){var h=f[g],i=h.indexOf("="),j=h.substring(0,i),k=h.substring(i+1);try{k=decodeURIComponent(k)}catch(a){ck_debug&&console.log("CallKeepCookieHandler - loadCookies - ошибка не получилось раскодировать значение: "+k+" пишем его в сыром виде")}a[j]=k}c=[];for(var l in a)c.push(l);d=c.length,e=a}var c=[],d=0,e={};f(),this.key=function(a){return a<0||a>=c.length?null:c[a]},this.getItem=function(a){return f(),e[a]||null},this.setItem=function(g,h){f(),g in e||(c.push(g),d++),e[g]=h;var i=g+"="+encodeURIComponent(h);a&&(i+="; max-age="+a),b&&(i+="; path="+b),document.cookie=i},this.removeItem=function(a){if(f(),a in e){delete e[a];for(var b=0,g=c.length;b<g;b++)if(c[b]===a){c.splice(b,1);break}d--,document.cookie=a+"=; max-age=0"}},this.clear=function(){this.removeItem("callkeep_vers"),this.removeItem("callkeep_rfr"),this.removeItem("callkeep_ep"),this.removeItem("callkeep_ept"),this.removeItem("callkeep_eph1"),this.removeItem("callkeep_os"),this.removeItem("callkeep_utmcamp"),this.removeItem("callkeep_utmsrc"),this.removeItem("callkeep_gclid"),this.removeItem("callkeep_cst"),this.removeItem("callkeep_cs"),this.removeItem("callkeep_aw"),this.removeItem("callkeep_rflc"),this.removeItem("callkeep_lat"),this.removeItem("callkeep_lst"),this.removeItem("callkeep_fst"),this.removeItem("callkeep_ts"),this.removeItem("callkeep_lct"),this.removeItem("callkeep_summsec"),this.removeItem("callkeep_main"),this.removeItem("callkeep_act_cond")}}return b}(),DialogWidget.CallKeepLocalStorageHandler=function(){function b(){var a=window.localStorage;this.getItem=function(b){return a.getItem(b)},this.setItem=function(b,c){function h(a){var b=!1;if(a)if(a.code)switch(a.code){case 22:b=!0;break;case 1014:"NS_ERROR_DOM_QUOTA_REACHED"===a.name&&(b=!0)}else a.number===-2147024882&&(b=!0);return b}try{a.setItem(b,c)}catch(j){if(h(j)){var g,d=new DialogWidget.CallKeepCookieHandler(2592e3,"/"),e=a.length,f=new RegExp("^callkeep_","i");for(i=0;i<e;i++)g=a.key(i),g.match(f)&&d.setItem(g,a.getItem(g));DialogWidget.globalDW.client_memory=d,DialogWidget.globalDW.client_memory.setItem(b,c),this.clear(),console.log("DW Error: LocalStorage переполнен. Переключюсь на Cookies")}}},this.removeItem=function(b){a.removeItem(b)},this.clear=function(){a.removeItem("callkeep_vers"),a.removeItem("callkeep_rfr"),a.removeItem("callkeep_ep"),a.removeItem("callkeep_ept"),a.removeItem("callkeep_eph1"),a.removeItem("callkeep_os"),a.removeItem("callkeep_utmcamp"),a.removeItem("callkeep_utmsrc"),a.removeItem("callkeep_gclid"),a.removeItem("callkeep_cst"),a.removeItem("callkeep_cs"),a.removeItem("callkeep_aw"),a.removeItem("callkeep_rflc"),a.removeItem("callkeep_lat"),a.removeItem("callkeep_lst"),a.removeItem("callkeep_fst"),a.removeItem("callkeep_lct"),a.removeItem("callkeep_ts"),a.removeItem("callkeep_summsec"),a.removeItem("callkeep_main"),a.removeItem("callkeep_act_cond")}}return b}();var ck_debug=!1,ck_debug_periods=!1;"function"==typeof jQuery?jQuery(function(a){var b=a("#dw_script");b.is("script")&&b.data("dwk")&&(DialogWidget.globalDW=new DialogWidget.DW(b.data("dwk")),DialogWidget.globalDW.init())}):console.log("DW Error: jQuery не найдена. Запуск отменён.");